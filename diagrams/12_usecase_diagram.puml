@startuml Use Case Diagram
!theme plain
left to right direction

title Antifraud System - Use Cases

actor "HTTP Client" as http
actor "Kafka Producer\n(tx-generator)" as kafka
actor "Airflow DAG" as airflow
actor "Analyst" as analyst
actor "Administrator" as admin
actor "Developer" as dev

rectangle "Antifraud System" {

    package "Transaction Processing" {
        usecase "Submit Transaction\n(HTTP)" as UC1
        usecase "Submit Transaction\n(Kafka)" as UC2
        usecase "Submit Batch\n(CSV via Airflow)" as UC3
        usecase "Evaluate Fraud Rules" as UC4
        usecase "Generate Alert" as UC5
        usecase "Decline Transaction" as UC6
    }

    package "Query & Search" {
        usecase "Search Transactions" as UC7
        usecase "View Transaction\nby ID" as UC8
        usecase "Filter by Account" as UC9
        usecase "Filter by Status" as UC10
    }

    package "Rule Management" {
        usecase "View All Rules" as UC11
        usecase "Update Rule\nThreshold" as UC12
        usecase "Enable/Disable Rule" as UC13
        usecase "Change Rule\nSeverity" as UC14
    }

    package "Analytics (CDM)" {
        usecase "View TX per Minute" as UC15
        usecase "View Fraud Totals" as UC16
        usecase "View Top Fraud\nMerchants" as UC17
        usecase "View Top Fraud\nAccounts" as UC18
        usecase "View Rules\nDistribution" as UC19
        usecase "View Fraud by\nCountry" as UC20
        usecase "View Blocked TX\nTimeline" as UC21
        usecase "View Saved Money" as UC22
        usecase "Refresh CDM\n(Scheduled)" as UC23
    }

    package "Monitoring" {
        usecase "View Metrics\n(Prometheus)" as UC24
        usecase "View Dashboards\n(Grafana)" as UC25
        usecase "Monitor Kafka\n(Kafka UI)" as UC26
        usecase "Manage DAGs\n(Airflow UI)" as UC27
    }
}

' Transaction submission
http --> UC1
kafka --> UC2
airflow --> UC3

' Fraud evaluation chain
UC1 ..> UC4 : <<include>>
UC2 ..> UC4 : <<include>>
UC3 ..> UC4 : <<include>>
UC4 ..> UC5 : <<extend>>\n[fraud detected]
UC5 ..> UC6 : <<include>>

' Query operations
http --> UC7
http --> UC8
UC7 ..> UC9 : <<extend>>
UC7 ..> UC10 : <<extend>>

' Admin operations
admin --> UC11
admin --> UC12
admin --> UC13
admin --> UC14

' Analytics
analyst --> UC15
analyst --> UC16
analyst --> UC17
analyst --> UC18
analyst --> UC19
analyst --> UC20
analyst --> UC21
analyst --> UC22
airflow --> UC23

' Monitoring
dev --> UC24
dev --> UC25
dev --> UC26
dev --> UC27
admin --> UC27

note right of UC4
    Fraud Rules:
    1. HIGH_AMOUNT
    2. VELOCITY
    3. GEO_JUMP
end note

note right of UC23
    Runs every minute
    via Airflow scheduler
end note

@enduml
